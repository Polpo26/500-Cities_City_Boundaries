<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>City Limits map</title>
    <!-- leaflet.css -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
    <!-- css -->
    <link rel="stylesheet" href="style.css" />
      
    <link rel="stylesheet" href="css/leaflet-search.css" />
    <!-- leaflet1.5.1 -->
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
    <!-- jquery3.4.1 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- turf@5 -->
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@5/turf.min.js"></script>
    <!-- data -->
    <!-- City Limits -->
    <script src="geoJSON/cityBoundaries_low.geojson"></script>
    
    <script src="js/leaflet-search.js"></script>   
    
  </head>

  <body>
    <div id="map"></div>


    <script type="text/javascript">

  var map = L.map('map', {
    center: [43.6625, 10.6364]
  });
        

var citiesBoundary = L.geoJSON(cities, {
    opacity: 0.5,    
    color: 'black',
    fillColor: 'grey',
    fillOpacity: 0.2,
    weight: 1,
    onEachFeature: function(feature, layer) {
        layer.on({
            mouseover: highlightFeatureOnMouseOver, // hover
            mouseout: resetFeatureStyle
        });
    }
});

map.fitBounds(citiesBoundary.getBounds());
        
function highlightFeatureOnMouseOver(e) {
    e.target.setStyle({
        opacity: 1,      
        color: 'red',
        fillColor: 'yellow',
        fillOpacity: 0.5,
        weight: 2
    });
    e.target.bringToFront();
}

function resetFeatureStyle(e) {
    citiesBoundary.resetStyle(e.target);
}

citiesBoundary.eachLayer(function(layer) {
    var popupContent = '<b>NAME</b>: ' + layer.feature.properties.NAME;
    layer.bindPopup(popupContent);
});

  // http://leaflet-extras.github.io/leaflet-providers/preview/index.html
  var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
  });

  var Wikimedia = L.tileLayer('https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png', {
    attribution: '<a href="https://wikimediafoundation.org/wiki/Maps_Terms_of_Use">Wikimedia</a>',
    minZoom: 1,
    maxZoom: 19
  });
  var OpenTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
    maxZoom: 17,
    attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
  });

  var Stamen_Toner = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}{r}.{ext}', {
    attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    subdomains: 'abcd',
    minZoom: 0,
    maxZoom: 20,
    ext: 'png'
  });

  var basemaps = {
    "OpenStreetMap": OpenStreetMap_Mapnik,
    "Stamen Toner": Stamen_Toner,
    "Wikimedia": Wikimedia,
    "Esri WorldImagery": Esri_WorldImagery,
    "OpenTopoMap": OpenTopoMap
  };


// Search by layer
var searchControl = new L.Control.Search({
    layer: citiesBoundary,
    position: 'topleft',
    propertyName: 'NAME',
    marker: false,
    moveToLocation: function(latlng, title, map) {
        //map.fitBounds( latlng.layer.getBounds() );
        var zoom = map.getBoundsZoom(latlng.layer.getBounds());
        map.setView(latlng, zoom); // access the zoom
    }
});

searchControl.on('search:locationfound', function(e) {

    //console.log('search:locationfound', );

    //map.removeLayer(this._markerSearch)

    e.layer.setStyle({fillColor: 'yellow', color: 'black'});
//		if(e.layer._popup)
//			e.layer.openPopup();

}).on('search:collapsed', function(e) {

    featuresLayer.eachLayer(function(layer) {	//restore feature color
        featuresLayer.resetStyle(layer);
    });	
});

map.addControl( searchControl );  //inizialize search control


    </script>
  </body>
</html>
